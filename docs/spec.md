# ccplan â€” Claude Code Plan CLI ãƒ„ãƒ¼ãƒ« è¦ä»¶å®šç¾©æ›¸

## æ¦‚è¦

Claude Codeã®planãƒ¢ãƒ¼ãƒ‰ã§ç”Ÿæˆã•ã‚Œã‚‹ãƒ—ãƒ©ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ“ä½œã™ã‚‹ãŸã‚ã®CLIãƒ„ãƒ¼ãƒ«ã€‚
ãƒ—ãƒ©ãƒ³ã®å¯è¦–åŒ–ãƒ»ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ»æ¤œå‡ºãƒ»Claude Code hookã¨ã®çµ±åˆã‚’1ãƒã‚¤ãƒŠãƒªã§æä¾›ã™ã‚‹ã€‚

### ã‚³ãƒãƒ³ãƒ‰å: `ccplan`

> "cc" = Claude Codeã€‚`plan` å˜ä½“ã ã¨æ±ç”¨çš„ã™ãã‚‹ãŸã‚ã€‚

### ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰ä¸€è¦§

| ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰ | èª¬æ˜ | ãƒ•ã‚§ãƒ¼ã‚º |
|-------------|------|---------|
| `ccplan review` | ãƒ—ãƒ©ãƒ³ã‚’TUIã§å¯è¦–åŒ–ã—ã€ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆã‚’ä»˜ä¸ | Phase 1 |
| `ccplan locate` | transcript/è¨­å®šã‹ã‚‰ãƒ—ãƒ©ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ã‚’ç‰¹å®šã—ã¦å‡ºåŠ› | Phase 1 |
| `ccplan hook` | Claude Codeã®PostToolUse hookã¨ã—ã¦å‹•ä½œï¼ˆreview + ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼‰ | Phase 2 |
| `ccplan list` | plansDirectoryå†…ã®ãƒ—ãƒ©ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã‚’è¡¨ç¤º | å°†æ¥ |
| `ccplan diff` | 2ã¤ã®ãƒ—ãƒ©ãƒ³ã®å·®åˆ†ã‚’è¡¨ç¤º | å°†æ¥ |
| `ccplan clean` | å¤ã„ãƒ—ãƒ©ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã®å‰Šé™¤ | å°†æ¥ |

### è§£æ±ºã™ã‚‹èª²é¡Œ

| èª²é¡Œ | ç¾çŠ¶ | ç›®æŒ‡ã™ä½“é¨“ |
|------|------|-----------|
| å…¨ä½“åƒãŒæ´ã¿ã«ãã„ | ãƒ—ãƒ©ãƒ³ãŒé•·æ–‡ã§ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«æµã‚Œã‚‹ | æŠ˜ã‚ŠãŸãŸã¿å¯èƒ½ãªã‚¹ãƒ†ãƒƒãƒ—ä¸€è¦§ + ã‚µãƒãƒªãƒ¼ãƒ“ãƒ¥ãƒ¼ |
| ç‰¹å®šç®‡æ‰€ã‚’æŒ‡ã—ç¤ºã—ã«ãã„ | ã€Œ3ç•ªç›®ã®ã‚„ã¤ã€ã®ã‚ˆã†ãªæ›–æ˜§ãªæŒ‡ç¤º | ã‚¹ãƒ†ãƒƒãƒ—ã‚’é¸æŠã—ã¦ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚³ãƒ¡ãƒ³ãƒˆ |
| è¤‡æ•°ç®‡æ‰€ã¸ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãŒé¢å€’ | 1ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«å…¨éƒ¨æ›¸ãå¿…è¦ãŒã‚ã‚‹ | å„ã‚¹ãƒ†ãƒƒãƒ—ã«å€‹åˆ¥ã‚³ãƒ¡ãƒ³ãƒˆ â†’ ã¾ã¨ã‚ã¦å‡ºåŠ› |
| hookã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒbash + jqä¾å­˜ã§è„†ã„ | bashã§JSONLãƒ‘ãƒ¼ã‚¹ã¯ä¿å®ˆæ€§ãŒä½ã„ | Goè£½ãƒã‚¤ãƒŠãƒªã§å …ç‰¢ã«å‡¦ç† |

---

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **è¨€èª**: Go
- **TUIãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: [Bubble Tea](https://github.com/charmbracelet/bubbletea)
- **ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°**: [Lip Gloss](https://github.com/charmbracelet/lipgloss)
- **UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**: [Bubbles](https://github.com/charmbracelet/bubbles) â€” viewport, textarea, key
- **Markdownãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°**: [Glamour](https://github.com/charmbracelet/glamour)
- **Markdown ASTè§£æ**: [goldmark](https://github.com/yuin/goldmark)ï¼ˆGlamourãŒå†…éƒ¨ã§ä½¿ç”¨ã—ã¦ã„ã‚‹ãƒ‘ãƒ¼ã‚µãƒ¼ï¼‰
- **CLIãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: [kong](https://github.com/alecthomas/kong)

### è‡ªä½œ/æ—¢å­˜ã®åˆ¤æ–­

TUIã®ã€ŒMarkdownãƒ“ãƒ¥ãƒ¼ã‚¢ã€ã‚’æ©Ÿèƒ½ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§åˆ†è§£ã—ã€å„ãƒ¬ã‚¤ãƒ¤ãƒ¼ã”ã¨ã«è‡ªä½œã‹æ—¢å­˜åˆ©ç”¨ã‹ã‚’åˆ¤æ–­ã—ãŸã€‚

| ãƒ¬ã‚¤ãƒ¤ãƒ¼ | ä½•ã‚’ã™ã‚‹ã‹ | åˆ¤æ–­ | ç†ç”± |
|---------|-----------|------|------|
| Markdown â†’ ANSIãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° | MDæ–‡å­—åˆ—ã‚’ã‚¹ã‚¿ã‚¤ãƒ«ä»˜ãã‚¿ãƒ¼ãƒŸãƒŠãƒ«ãƒ†ã‚­ã‚¹ãƒˆã«å¤‰æ› | **æ—¢å­˜: Glamour** | é«˜å“è³ªã§å®‰å®šã€‚è‡ªä½œã™ã‚‹ç†ç”±ãŒãªã„ |
| ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ãªãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆ | ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ¸ˆã¿ãƒ†ã‚­ã‚¹ãƒˆã®è¡¨ç¤ºãƒ»ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« | **æ—¢å­˜: bubbles/viewport** | æ¨™æº–çš„ãªUIéƒ¨å“ã€‚ãã®ã¾ã¾ä½¿ãˆã‚‹ |
| ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ› | ã‚³ãƒ¡ãƒ³ãƒˆç”¨ã®è¤‡æ•°è¡Œãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ› | **æ—¢å­˜: bubbles/textarea** | æ¨™æº–çš„ãªUIéƒ¨å“ |
| è¦‹å‡ºã—ãƒ™ãƒ¼ã‚¹ã®ã‚¹ãƒ†ãƒƒãƒ—åˆ†å‰² | MDã‚’ `[]Step` æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ã«å¤‰æ› | **è‡ªä½œ** | ç‹¬è‡ªã®ãƒ‘ãƒ¼ã‚¹ãƒ«ãƒ¼ãƒ«ï¼ˆè¦‹å‡ºã—ãƒ¬ãƒ™ãƒ«â†’è¦ªå­é–¢ä¿‚ã€IDæ¡ç•ªï¼‰ |
| ã‚¹ãƒ†ãƒƒãƒ—é€£å‹•ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ | å·¦ãƒšã‚¤ãƒ³ã§é¸æŠâ†’å³ãƒšã‚¤ãƒ³ã®è¡¨ç¤ºã‚’åˆ‡æ›¿ | **è‡ªä½œ** | ã“ã®å¯¾è©±ãƒ¢ãƒ‡ãƒ«ã¯æœ¬ãƒ„ãƒ¼ãƒ«å›ºæœ‰ |
| ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚³ãƒ¡ãƒ³ãƒˆä»˜ä¸ | ã‚¹ãƒ†ãƒƒãƒ—ã”ã¨ã«ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆã‚’ç´ä»˜ã‘ | **è‡ªä½œ** | ã‚³ã‚¢æ©Ÿèƒ½ã€‚æ—¢å­˜ãƒ„ãƒ¼ãƒ«ã«ã¯ãªã„ |
| 2ãƒšã‚¤ãƒ³ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆåˆæˆ | å·¦å³ãƒšã‚¤ãƒ³ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã¨ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ç®¡ç† | **è‡ªä½œ** | Lip Glossã§çµ„ã‚€ãŒã€çŠ¶æ…‹ç®¡ç†ã¯è‡ªå‰ |

> **Glowã¨ã®é–¢ä¿‚**: charmbracelet/glow ã¯æœ€ã‚‚è¿‘ã„æ—¢å­˜TUIã ãŒã€1ãƒ•ã‚¡ã‚¤ãƒ«å˜ä½ã®ãƒ–ãƒ©ã‚¦ã‚ºï¼‹é–²è¦§ãŒç›®çš„ã§ã‚ã‚Šã€
> ãƒ•ã‚¡ã‚¤ãƒ«å†…ã‚’æ§‹é€ åŒ–ã—ã¦å¯¾è©±çš„ã«æ“ä½œã™ã‚‹è¨­è¨ˆã§ã¯ãªã„ã€‚Glowã‚’æ”¹é€ ã™ã‚‹ã‚ˆã‚Šã€Glowã¨åŒã˜æ§‹æˆè¦ç´ 
> ï¼ˆGlamour + viewport + listï¼‰ã‚’ç›´æ¥çµ„ã¿åˆã‚ã›ã¦æ§‹ç¯‰ã™ã‚‹æ–¹ãŒåŠ¹ç‡çš„ã€‚

---

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
ccplan/
â”œâ”€â”€ cmd/
â”‚   â”œâ”€â”€ cli.go               # kong CLIå®šç¾©ï¼ˆstruct tags ãƒ™ãƒ¼ã‚¹ï¼‰
â”‚   â”œâ”€â”€ review.go            # ccplan review ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”œâ”€â”€ locate.go            # ccplan locate ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œãƒ­ã‚¸ãƒƒã‚¯
â”‚   â””â”€â”€ hook.go              # ccplan hook ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œãƒ­ã‚¸ãƒƒã‚¯ (Phase 2)
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ plan/                # ãƒ—ãƒ©ãƒ³é–¢é€£ã®å…±é€šãƒ­ã‚¸ãƒƒã‚¯ï¼ˆã‚³ã‚¢ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼‰ã€è‡ªä½œã€‘
â”‚   â”‚   â”œâ”€â”€ model.go         # Plan, Step ç­‰ã®ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«
â”‚   â”‚   â”œâ”€â”€ parser.go        # goldmark AST â†’ []Step æ§‹é€ åŒ–
â”‚   â”‚   â”œâ”€â”€ parser_test.go
â”‚   â”‚   â”œâ”€â”€ review.go        # ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœã®Markdownãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿
â”‚   â”‚   â””â”€â”€ review_test.go
â”‚   â”œâ”€â”€ locate/              # ãƒ—ãƒ©ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ç‰¹å®šã€è‡ªä½œã€‘
â”‚   â”‚   â”œâ”€â”€ locator.go       # LocatePlanFile + ParseHookInput
â”‚   â”‚   â”œâ”€â”€ settings.go      # plansDirectoryè¨­å®šã®è§£æ±º
â”‚   â”‚   â”œâ”€â”€ settings_test.go
â”‚   â”‚   â”œâ”€â”€ transcript.go    # JSONL transcriptãƒ‘ãƒ¼ã‚µãƒ¼
â”‚   â”‚   â””â”€â”€ transcript_test.go
â”‚   â”œâ”€â”€ hook/                # Claude Code hookçµ±åˆã€è‡ªä½œã€‘(Phase 2)
â”‚   â”‚   â”œâ”€â”€ input.go         # hook stdinã®JSONãƒ‘ãƒ¼ã‚µãƒ¼
â”‚   â”‚   â”œâ”€â”€ input_test.go
â”‚   â”‚   â””â”€â”€ runner.go        # hookã®ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”œâ”€â”€ pane/                # ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ãƒšã‚¤ãƒ³æ“ä½œã€è‡ªä½œã€‘(Phase 2)
â”‚   â”‚   â”œâ”€â”€ spawner.go       # PaneSpawner interface
â”‚   â”‚   â”œâ”€â”€ wezterm.go       # WezTermå®Ÿè£…
â”‚   â”‚   â”œâ”€â”€ tmux.go          # tmuxå®Ÿè£…ï¼ˆå°†æ¥ï¼‰
â”‚   â”‚   â””â”€â”€ detect.go        # ãƒãƒ«ãƒãƒ—ãƒ¬ã‚¯ã‚µè‡ªå‹•æ¤œå‡º
â”‚   â””â”€â”€ tui/                 # TUIï¼ˆBubble Tea + è‡ªä½œãƒ­ã‚¸ãƒƒã‚¯ï¼‰
â”‚       â”œâ”€â”€ app.go           # ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ï¼ˆ2ãƒšã‚¤ãƒ³åˆæˆ + çŠ¶æ…‹ç®¡ç†ï¼‰ã€è‡ªä½œã€‘
â”‚       â”œâ”€â”€ app_test.go      # TUIå›å¸°ãƒ†ã‚¹ãƒˆï¼ˆç”»é¢ã¯ã¿å‡ºã—ãƒ»ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç­‰ï¼‰
â”‚       â”œâ”€â”€ steplist.go      # å·¦ãƒšã‚¤ãƒ³ï¼šã‚¹ãƒ†ãƒƒãƒ—ä¸€è¦§ãƒ„ãƒªãƒ¼ã€è‡ªä½œã€bubbles/listå‚è€ƒã€‘
â”‚       â”œâ”€â”€ detail.go        # å³ãƒšã‚¤ãƒ³ï¼šGlamourãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° + bubbles/viewport
â”‚       â”œâ”€â”€ comment.go       # ã‚³ãƒ¡ãƒ³ãƒˆå…¥åŠ›ï¼ˆbubbles/textarea ã‚’ãƒ©ãƒƒãƒ—ï¼‰
â”‚       â”œâ”€â”€ commentlist.go   # ã‚³ãƒ¡ãƒ³ãƒˆä¸€è¦§ç®¡ç†ï¼ˆç·¨é›†ãƒ»å‰Šé™¤ï¼‰
â”‚       â”œâ”€â”€ search.go        # ã‚¹ãƒ†ãƒƒãƒ—æ¤œç´¢ãƒãƒ¼
â”‚       â”œâ”€â”€ styles.go        # Lip Gloss ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾©
â”‚       â””â”€â”€ keymap.go        # ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰å®šç¾©ï¼ˆbubbles/keyï¼‰
â”œâ”€â”€ main.go
â”œâ”€â”€ go.mod
â””â”€â”€ go.sum
```

### TUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨æ—¢å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å¯¾å¿œ

```
â”Œâ”€ steplist.go â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€ detail.go â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              â”‚                                      â”‚
â”‚  è‡ªä½œãƒ„ãƒªãƒ¼ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ        â”‚  bubbles/viewport                    â”‚
â”‚  (bubbles/list ã® Delegate   â”‚    â””â”€ Glamour ã§ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ãŸ       â”‚
â”‚   ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å‚è€ƒã«å®Ÿè£…)       â”‚       ã‚¹ãƒ†ãƒƒãƒ—æœ¬æ–‡ã‚’è¡¨ç¤º              â”‚
â”‚                              â”‚                                      â”‚
â”‚  å…¥åŠ›: internal/plan ã®       â”‚  comment.go                          â”‚
â”‚        []Step ãƒ¢ãƒ‡ãƒ«          â”‚    â””â”€ bubbles/textarea ã‚’ãƒ©ãƒƒãƒ—       â”‚
â”‚                              â”‚                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  app.go: Lip Gloss ã® JoinHorizontal ã§ãƒšã‚¤ãƒ³åˆæˆ                    â”‚
â”‚  keymap.go: bubbles/key ã§ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰å®šç¾©                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### kong CLIå®šç¾©

`cmd/cli.go`ï¼ˆPhase 1 æ™‚ç‚¹ï¼‰:

```go
type CLI struct {
    Review  ReviewCmd  `cmd:"" help:"Review a plan file in TUI"`
    Locate  LocateCmd  `cmd:"" help:"Locate plan file path from transcript"`
    Hook    HookCmd    `cmd:"" help:"Run as Claude Code PostToolUse hook"`
    Version VersionCmd `cmd:"" help:"Show version"`
}

type ReviewCmd struct {
    PlanFile   string `arg:"" help:"Path to the Markdown plan file"`
    Output     string `enum:"clipboard,stdout,file" default:"clipboard" help:"Output method (clipboard|stdout|file)"`
    OutputPath string `help:"File path for file output" type:"path"`
    Theme      string `enum:"dark,light" default:"dark" help:"Color theme (dark|light)"`
}

type LocateCmd struct {
    Transcript string `help:"Path to transcript JSONL file" type:"existingfile"`
    CWD        string `help:"Working directory for resolving relative plansDirectory" default:"." type:"existingdir"`
    Stdin      bool   `help:"Read hook JSON input from stdin"`
    All        bool   `help:"Output all plan files found in transcript"`
}

// Phase 2
type HookCmd struct {
    Spawner string `enum:"wezterm,tmux,auto" default:"auto" help:"Force specific multiplexer (wezterm|tmux|auto)"`
    Theme   string `enum:"dark,light" default:"dark" help:"Color theme (dark|light)"`
}
```

`main.go`:

```go
func main() {
    var cli cmd.CLI
    ctx := kong.Parse(&cli,
        kong.Name("ccplan"),
        kong.Description("Claude Code Plan CLI tool"),
        kong.UsageOnError(),
    )
    err := ctx.Run()
    ctx.FatalIfErrorf(err)
}
```

### ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸é–“ã®ä¾å­˜é–¢ä¿‚

```
cmd/review  â†’ internal/plan, internal/tui
cmd/locate  â†’ internal/locate
cmd/hook    â†’ internal/locate, internal/hook, internal/pane, internal/plan, internal/tui
                â†‘ hook ã¯ locate + review ã®åˆæˆ

internal/tui    â†’ internal/plan ï¼ˆãƒ‘ãƒ¼ã‚¹çµæœã®ãƒ¢ãƒ‡ãƒ«ã‚’è¡¨ç¤ºï¼‰
internal/hook   â†’ internal/locate ï¼ˆplansDirectoryè§£æ±ºã®ã¿ï¼‰
internal/locate â†’ internal/plan ã¯å‚ç…§ã—ãªã„ï¼ˆãƒ‘ã‚¹ã®ç‰¹å®šã®ã¿ï¼‰
internal/pane   â†’ ä»–ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¸ã®ä¾å­˜ãªã—
```

`internal/locate` ã¨ `internal/plan` ã‚’åˆ†é›¢ã—ã¦ã„ã‚‹ã®ãŒãƒã‚¤ãƒ³ãƒˆã€‚`locate` ã¯ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã®ç‰¹å®šã ã‘ã‚’è²¬å‹™ã¨ã—ã€Markdownã®ä¸­èº«ã«ã¯é–¢ä¸ã—ãªã„ã€‚ã“ã‚Œã«ã‚ˆã‚Š `ccplan locate` ã¯ç´”ç²‹ãªãƒ‘ã‚¹è§£æ±ºãƒ„ãƒ¼ãƒ«ã¨ã—ã¦ä»–ç”¨é€”ã«ã‚‚ä½¿ãˆã‚‹ã€‚

---

## ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰è©³ç´°

### `ccplan review` â€” ãƒ—ãƒ©ãƒ³ã®TUIãƒ¬ãƒ“ãƒ¥ãƒ¼

ãƒ—ãƒ©ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’TUIã§è¡¨ç¤ºã—ã€å„ã‚¹ãƒ†ãƒƒãƒ—ã«ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆã‚’ä»˜ä¸ã™ã‚‹ã€‚

```
ccplan review [flags] <plan-file>

Arguments:
  plan-file    Path to the Markdown plan file

Flags:
  --output       Output method: clipboard (default), stdout, file
  --output-path  File path for file output
  --theme        Color theme: dark (default), light
```

#### ä½¿ç”¨ä¾‹

```bash
# åŸºæœ¬ï¼ˆæ‰‹å‹•èµ·å‹•ã€ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ï¼‰
ccplan review ~/.claude/plans/my-plan.md

# ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«å‡ºåŠ›
ccplan review --output file --output-path ./review.md plan.md

# ãƒ‘ã‚¤ãƒ—ã§åˆ¥ã‚³ãƒãƒ³ãƒ‰ã«æ¸¡ã™
ccplan review --output stdout plan.md | pbcopy
```

---

### `ccplan locate` â€” ãƒ—ãƒ©ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã®ç‰¹å®š

transcript JSONLã¨settings.jsonã‹ã‚‰ãƒ—ãƒ©ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ã‚’æ©Ÿæ¢°çš„ã«ç‰¹å®šã™ã‚‹ã€‚
æ¨™æº–å‡ºåŠ›ã«ãƒ‘ã‚¹ã‚’å‡ºåŠ›ã™ã‚‹ã ã‘ã®ã‚·ãƒ³ãƒ—ãƒ«ãªã‚³ãƒãƒ³ãƒ‰ã€‚ä»–ãƒ„ãƒ¼ãƒ«ã‚„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¨ã®é€£æºã«ä½¿ãˆã‚‹ã€‚

```
ccplan locate [flags]

Flags:
  --transcript   Path to transcript JSONL file (required unless --stdin)
  --cwd          Working directory for resolving relative plansDirectory (default: .)
  --stdin        Read hook JSON input from stdin (transcript_path / cwd ã‚’è‡ªå‹•æŠ½å‡º)
  --all          Output all plan files found in transcript (default: latest only)
```

#### ä½¿ç”¨ä¾‹

```bash
# transcriptãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã—ã¦ãƒ—ãƒ©ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç‰¹å®š
ccplan locate --transcript ~/.claude/projects/.../session.jsonl
# â†’ /home/user/.claude/plans/jaunty-petting-nebula.md

# hookå…¥åŠ›ã‚’stdinã‹ã‚‰èª­ã‚“ã§ç‰¹å®šï¼ˆhookã‚¹ã‚¯ãƒªãƒ—ãƒˆã¨ã®é€£æºï¼‰
echo "$HOOK_INPUT" | ccplan locate --stdin
# â†’ /home/user/.claude/plans/jaunty-petting-nebula.md

# ã‚»ãƒƒã‚·ãƒ§ãƒ³å†…ã®å…¨ãƒ—ãƒ©ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ—æŒ™
ccplan locate --transcript session.jsonl --all
# â†’ /home/user/.claude/plans/plan-a.md
# â†’ /home/user/.claude/plans/plan-b.md

# ä»–ã‚³ãƒãƒ³ãƒ‰ã¨ã®çµ„ã¿åˆã‚ã›
ccplan review "$(ccplan locate --transcript session.jsonl)"
```

#### æ¤œå‡ºã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

```
1. plansDirectory ã®è§£æ±º
   a. {cwd}/.claude/settings.local.json ã® "plansDirectory" ã‚’ç¢ºèª
   b. {cwd}/.claude/settings.json ã® "plansDirectory" ã‚’ç¢ºèª
   c. ~/.claude/settings.json ã® "plansDirectory" ã‚’ç¢ºèª
   d. ã„ãšã‚Œã‚‚æœªè¨­å®šãªã‚‰ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: ~/.claude/plans/
   e. ç›¸å¯¾ãƒ‘ã‚¹ã®å ´åˆã¯ cwd ã‹ã‚‰ã®ç›¸å¯¾ã¨ã—ã¦è§£æ±º

2. transcript JSONL ã®ãƒ‘ãƒ¼ã‚¹ï¼ˆå¾Œæ–¹ã‹ã‚‰èµ°æŸ»ï¼‰
   a. transcript ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æœ«å°¾ã‹ã‚‰1è¡Œãšã¤èª­ã‚€
   b. å„è¡Œã‚’JSONãƒ‘ãƒ¼ã‚¹ã—ã€ä»¥ä¸‹ã«åˆè‡´ã™ã‚‹è¡Œã‚’æ¢ã™:
      - assistant ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã® content é…åˆ—å†…ã«
        type == "tool_use" ã‹ã¤ name == "Write" ã®ã‚¨ãƒ³ãƒˆãƒªãŒã‚ã‚‹
      - ãã® input.file_path ãŒ plansDirectory é…ä¸‹ã®ãƒ‘ã‚¹ã§ã‚ã‚‹
   c. --all ã§ãªã„å ´åˆã€æœ€æ–°ã®1ä»¶ã‚’å‡ºåŠ›ã—ã¦çµ‚äº†

3. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
   a. ç‰¹å®šã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ãŒå®Ÿéš›ã«å­˜åœ¨ã™ã‚‹ã‹ç¢ºèª
   b. å­˜åœ¨ã—ãªã‘ã‚Œã°ã‚¹ã‚­ãƒƒãƒ—
```

#### ä¸¦è¡Œã‚»ãƒƒã‚·ãƒ§ãƒ³æ™‚ã®å®‰å…¨æ€§

| ã‚·ãƒŠãƒªã‚ª | å‹•ä½œ |
|---------|------|
| ã‚»ãƒƒã‚·ãƒ§ãƒ³Aã¨BãŒä¸¦è¡Œã§ãƒ—ãƒ©ãƒ³ä½œæˆ | å„hookã¯è‡ªèº«ã® `transcript_path` ã®ã¿å‚ç…§ã™ã‚‹ãŸã‚ã€Aã®hookã¯Aã®ãƒ—ãƒ©ãƒ³ã ã‘ã‚’ã€Bã®hookã¯Bã®ãƒ—ãƒ©ãƒ³ã ã‘ã‚’æ­£ç¢ºã«ç‰¹å®šã™ã‚‹ |
| ãƒ—ãƒ©ãƒ³ã‚’ä½œæˆã—ãªã„ã‚»ãƒƒã‚·ãƒ§ãƒ³ | `permission_mode != "plan"` ã§æ—©æœŸreturnã€‚ã¾ãŸtranscriptå†…ã«plansDiré…ä¸‹ã®WriteãŒãªã„ãŸã‚ç©ºå‡ºåŠ› |
| `plansDirectory` ãŒãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã”ã¨ã«ç•°ãªã‚‹ | è¨­å®šã®å„ªå…ˆåº¦ãƒã‚§ãƒ¼ãƒ³ã§æ­£ã—ã„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’è§£æ±º |

#### transcript JSONLã®æ§‹é€ ï¼ˆå‚è€ƒï¼‰

```jsonl
{"type":"assistant","message":{"role":"assistant","content":[{"type":"tool_use","id":"toolu_xxx","name":"Write","input":{"file_path":"/home/user/.claude/plans/jaunty-petting-nebula.md","content":"# Plan: ..."}}]},"sessionId":"eb5b0174-...","timestamp":"2025-..."}
```

> **æ³¨æ„**: transcriptã®JSONæ§‹é€ ã¯Claude Codeã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§å¤‰ã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã€‚
> ãƒ‘ãƒ¼ã‚¹å¤±æ•—æ™‚ã¯å¸¸ã«ç©ºå‡ºåŠ› + exit 1 ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã—ã€å‘¼ã³å‡ºã—å…ƒãŒãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã™ã‚‹ã€‚

---

### `ccplan hook` â€” Claude Code PostToolUse hookã¨ã—ã¦å‹•ä½œ

Claude Codeã® PostToolUse (Write|Edit) hook ã‹ã‚‰å‘¼ã°ã‚Œã€ãƒ—ãƒ©ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®æ›¸ãè¾¼ã¿ã‚’æ¤œçŸ¥ã—ã¦
review â†’ ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã®å…¨ãƒ•ãƒ­ãƒ¼ã‚’å®Ÿè¡Œã™ã‚‹ã€‚
**bashã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Œå…¨ã«ç½®ãæ›ãˆã‚‹ã€‚**

```
ccplan hook [flags]

Flags:
  --spawner      Force specific multiplexer: wezterm, tmux, auto (default: auto)
  --theme        Color theme: dark (default), light
```

stdinã‹ã‚‰hookã®JSONå…¥åŠ›ã‚’å—ã‘å–ã‚Šã€å†…éƒ¨ã§ä»¥ä¸‹ã‚’å®Ÿè¡Œ:

1. `permission_mode == "plan"` ã‹ãƒã‚§ãƒƒã‚¯ï¼ˆplanä»¥å¤–ã¯ exit 0ï¼‰
2. `PLAN_REVIEW_SKIP=1` ç’°å¢ƒå¤‰æ•°ãƒã‚§ãƒƒã‚¯ï¼ˆã‚¹ã‚­ãƒƒãƒ—ã€exit 0ï¼‰
3. `tool_input.file_path` ãŒ plansDirectory é…ä¸‹ã‹ãƒã‚§ãƒƒã‚¯ï¼ˆé…ä¸‹ã§ãªã‘ã‚Œã° exit 0ï¼‰
4. `internal/pane` ã§åˆ¥ãƒšã‚¤ãƒ³ã« `ccplan review` ã‚’èµ·å‹•
5. review ã®çµæœã«åŸºã¥ã:
   - submitted â†’ stderrã«ãƒ¬ãƒ“ãƒ¥ãƒ¼å†…å®¹ã‚’å‡ºåŠ›ã€exit 2ï¼ˆClaudeã«ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼‰
   - approved â†’ exit 0
   - cancelled â†’ exit 0

> **Stop hookã§ã¯ãªãPostToolUseã‚’ä½¿ã†ç†ç”±**: Claude Codeã®planãƒ¢ãƒ¼ãƒ‰ã§ã¯
> Stop hookãŒç™ºç«ã—ãªã„ãƒã‚°ãŒã‚ã‚‹ã€‚PostToolUse (Write|Edit) ã¯planãƒ¢ãƒ¼ãƒ‰ã§ã‚‚
> æ­£å¸¸ã«å‹•ä½œã—ã€ãƒ—ãƒ©ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®Write/Editç›´å¾Œã«ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’èµ·å‹•ã§ãã‚‹ã€‚
> ã¾ãŸã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒTUIã§ã‚³ãƒ¡ãƒ³ãƒˆãªã—submit/cancelã‚’é¸ã¶ã“ã¨ã§ãƒ«ãƒ¼ãƒ—ã‚’åˆ¶å¾¡ã§ãã‚‹ãŸã‚ã€
> ç„¡é™ãƒ«ãƒ¼ãƒ—é˜²æ­¢ã®ãŸã‚ã®ç‰¹åˆ¥ãªä»•çµ„ã¿ãŒä¸è¦ã«ãªã‚‹ã€‚

#### Claude Codeè¨­å®š

`.claude/settings.json`:

```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "ccplan hook",
            "timeout": 600
          }
        ]
      }
    ]
  }
}
```

`matcher: "Write|Edit"` ã§Write/Editãƒ„ãƒ¼ãƒ«ã«ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã€‚
Claudeã¯ãƒ—ãƒ©ãƒ³ä½œæˆæ™‚ã«Writeã€ä¿®æ­£æ™‚ã«Editã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ä¸¡æ–¹ãŒå¿…è¦ã€‚
ãƒ—ãƒ©ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ä»¥å¤–ã®Write/Editã¯ `isUnderPlansDir` ãƒã‚§ãƒƒã‚¯ã§å¼¾ã‹ã‚Œã‚‹ã€‚

#### å†…éƒ¨ãƒ•ãƒ­ãƒ¼ï¼ˆæ“¬ä¼¼ã‚³ãƒ¼ãƒ‰ï¼‰

```go
func RunHook(stdin io.Reader) error {
    // 1. hookå…¥åŠ›ã‚’ãƒ‘ãƒ¼ã‚¹
    input, err := hook.ParseInput(stdin)
    if err != nil {
        return nil // ãƒ‘ãƒ¼ã‚¹å¤±æ•—ã¯ä½•ã‚‚ã—ãªã„
    }

    // 2. æ—©æœŸãƒªã‚¿ãƒ¼ãƒ³åˆ¤å®š
    if input.PermissionMode != "plan" {
        os.Exit(0)
    }
    if os.Getenv("PLAN_REVIEW_SKIP") == "1" {
        os.Exit(0)
    }

    // 3. tool_input ã‹ã‚‰ãƒ—ãƒ©ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’å–å¾—
    if input.ToolInput == nil || input.ToolInput.FilePath == "" {
        os.Exit(0)
    }
    planFile := input.ToolInput.FilePath

    // 4. plansDirectory é…ä¸‹ã‹ãƒã‚§ãƒƒã‚¯
    plansDir := locate.ResolvePlansDir(input.CWD)
    if !isUnderPlansDir(planFile, plansDir) {
        os.Exit(0)
    }

    // 5. ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„
    reviewOutput := tmpFile("ccplan-review-*.md")
    defer cleanup(reviewOutput)

    // 6. åˆ¥ãƒšã‚¤ãƒ³ã§ review ã‚’èµ·å‹•ï¼ˆinternal/paneï¼‰
    spawner := pane.AutoDetect() // WezTerm â†’ tmux â†’ direct
    err = spawner.SpawnAndWait("ccplan", []string{
        "review",
        "--output", "file",
        "--output-path", reviewOutput,
        "--theme", cfg.Theme,
        planFile,
    })
    if err != nil {
        os.Exit(0) // ãƒšã‚¤ãƒ³èµ·å‹•å¤±æ•—ã¯ä½•ã‚‚ã—ãªã„
    }

    // 7. çµæœåˆ¤å®š â€” ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ãŒéç©ºãªã‚‰ submitted
    review := readFile(reviewOutput)
    if review != "" {
        fmt.Fprint(os.Stderr, review)
        os.Exit(2) // Claudeã«ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
    }
    os.Exit(0)
}
```

#### hookå…¥åŠ›ã®JSONæ§‹é€ 

```json
{
  "session_id": "eb5b0174-0555-4601-804e-672d68069c89",
  "transcript_path": "/home/user/.claude/projects/.../eb5b0174-....jsonl",
  "cwd": "/home/user/projects/myapp",
  "hook_event_name": "PostToolUse",
  "permission_mode": "plan",
  "tool_name": "Write",
  "tool_input": {
    "file_path": "/home/user/.claude/plans/jaunty-petting-nebula.md"
  }
}
```

#### ãƒ«ãƒ¼ãƒ—åˆ¶å¾¡

PostToolUseã§ã¯ç„¡é™ãƒ«ãƒ¼ãƒ—é˜²æ­¢ã®ç‰¹åˆ¥ãªä»•çµ„ã¿ã¯ä¸è¦ã€‚ç†ç”±:

1. **ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¶å¾¡**: TUIã§ã‚³ãƒ¡ãƒ³ãƒˆãªã—submit/cancelï¼ˆexit 0ï¼‰ã‚’é¸ã¹ã°ãƒ«ãƒ¼ãƒ—ã¯åœæ­¢ã™ã‚‹ã€‚
   submitï¼ˆexit 2ï¼‰ã‚’é¸ã‚“ã å ´åˆã®ã¿ClaudeãŒãƒ—ãƒ©ãƒ³ã‚’ä¿®æ­£ã—ã€å†åº¦Write/Editã§ç™ºç«ã™ã‚‹ã€‚
2. **ç’°å¢ƒå¤‰æ•°**: `PLAN_REVIEW_SKIP=1` ã§hookã‚’ä¸€æ™‚çš„ã«ç„¡åŠ¹åŒ–å¯èƒ½ã€‚

---

## `ccplan review` TUI è©³ç´°

### å…¥åŠ›: ãƒ—ãƒ©ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ãƒ¼ã‚¹

- Markdownãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹å¼•æ•°ã§å—ã‘å–ã‚‹
- Claude CodeãŒç”Ÿæˆã™ã‚‹è‡ªç”±å½¢å¼ã®Markdown
- **ã‚¹ãƒ†ãƒƒãƒ—åˆ†å‰²ã®åŸºæº–**: Markdownã®è¦‹å‡ºã—ï¼ˆ`#`, `##`, `###` ç­‰ï¼‰ã§åˆ†å‰²

#### ãƒ‘ãƒ¼ã‚¹æ–¹å¼: goldmark AST walk

æ­£è¦è¡¨ç¾ã«ã‚ˆã‚‹è¡Œå˜ä½ã®åˆ†å‰²ã§ã¯ãªãã€goldmarkã§Markdownã‚’ASTã«ãƒ‘ãƒ¼ã‚¹ã—ã€
Heading ãƒãƒ¼ãƒ‰ã‚’èµ·ç‚¹ã«ãƒ„ãƒªãƒ¼ã‚’èµ°æŸ»ã—ã¦ã‚¹ãƒ†ãƒƒãƒ—ã‚’æ§‹ç¯‰ã™ã‚‹ã€‚

- Glamour ãŒå†…éƒ¨ã§ goldmark ã‚’ä½¿ã£ã¦ã„ã‚‹ãŸã‚ã€ä¾å­˜ãŒå¢—ãˆãªã„
- ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯å†…ã® `#` ã‚’è¦‹å‡ºã—ã¨èª¤èªã—ãªã„ï¼ˆASTã§ã¯ CodeBlock ãƒãƒ¼ãƒ‰ã«ãªã‚‹ï¼‰
- å°†æ¥çš„ã«ãƒªã‚¹ãƒˆé …ç›®ã‚„ãƒªãƒ³ã‚¯ã®æŠ½å‡ºã«ã‚‚æ‹¡å¼µã—ã‚„ã™ã„

```go
// æ¦‚å¿µçš„ãªå‡¦ç†ãƒ•ãƒ­ãƒ¼
func Parse(source []byte) (*Plan, error) {
    md := goldmark.New()
    doc := md.Parser().Parse(text.NewReader(source))

    var steps []*Step
    ast.Walk(doc, func(n ast.Node, entering bool) (ast.WalkStatus, error) {
        if heading, ok := n.(*ast.Heading); ok && entering {
            title := extractText(heading, source)
            body := extractBodyUntilNextHeading(heading, source)
            steps = append(steps, &Step{
                Level: heading.Level,
                Title: title,
                Body:  body,
            })
        }
        return ast.WalkContinue, nil
    })

    return buildHierarchy(steps), nil  // level ã«åŸºã¥ã„ã¦è¦ªå­é–¢ä¿‚ã‚’æ§‹ç¯‰
}
```

#### ãƒ‘ãƒ¼ã‚¹ãƒ«ãƒ¼ãƒ«

```
# ãƒ—ãƒ©ãƒ³ã‚¿ã‚¤ãƒˆãƒ«           â†’ ãƒ—ãƒ©ãƒ³å…¨ä½“ã®ã‚¿ã‚¤ãƒˆãƒ«
ï¼ˆè¦‹å‡ºã—å‰ã®ãƒ†ã‚­ã‚¹ãƒˆï¼‰      â†’ preambleï¼ˆæ¦‚è¦ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼‰

## ã‚¹ãƒ†ãƒƒãƒ—1: èªè¨¼åŸºç›¤     â†’ Step (level 2)
æœ¬æ–‡...

### 1.1 JWTæ¤œè¨¼            â†’ Sub-step (level 3, parent = Step 1)
æœ¬æ–‡...

### 1.2 ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ç™»éŒ²    â†’ Sub-step (level 3, parent = Step 1)
æœ¬æ–‡...

## ã‚¹ãƒ†ãƒƒãƒ—2: ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°  â†’ Step (level 2)
æœ¬æ–‡...
```

#### ãƒ‘ãƒ¼ã‚¹ã§æŠ½å‡ºã™ã‚‹æƒ…å ±

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | æŠ½å‡ºæ–¹æ³• |
|-----------|---------|
| ID | è¦‹å‡ºã—ã®å‡ºç¾é †ã«è‡ªå‹•æ¡ç•ªï¼ˆS1, S1.1, S1.2, S2...ï¼‰ |
| ã‚¿ã‚¤ãƒˆãƒ« | è¦‹å‡ºã—ãƒ†ã‚­ã‚¹ãƒˆ |
| æœ¬æ–‡ | æ¬¡ã®è¦‹å‡ºã—ã¾ã§ã®Markdownãƒ†ã‚­ã‚¹ãƒˆ |
| å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ« | æœ¬æ–‡ä¸­ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆ`path/to/file.go` ç­‰ï¼‰ã‚’æŠ½å‡º |
| ä¾å­˜é–¢ä¿‚ | æœ¬æ–‡ä¸­ã®ä»–ã‚¹ãƒ†ãƒƒãƒ—ã¸ã®è¨€åŠã‚’ãƒ™ã‚¹ãƒˆã‚¨ãƒ•ã‚©ãƒ¼ãƒˆã§æŠ½å‡º |

### TUIç”»é¢æ§‹æˆ

#### ãƒ¡ã‚¤ãƒ³ãƒ“ãƒ¥ãƒ¼ï¼ˆ2ãƒšã‚¤ãƒ³ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼‰

**ãƒšã‚¤ãƒ³æ¯”ç‡**: å·¦ 30% / å³ 70%ï¼ˆã‚¿ãƒ¼ãƒŸãƒŠãƒ«å¹…ã«å¯¾ã™ã‚‹æ¯”ç‡ï¼‰ã€‚
ã‚¿ãƒ¼ãƒŸãƒŠãƒ«å¹…ãŒ 80 æœªæº€ã®å ´åˆã¯ã‚·ãƒ³ã‚°ãƒ«ãƒšã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ‰ï¼ˆå·¦ãƒšã‚¤ãƒ³ã®ã¿è¡¨ç¤ºã€Enterã§å³ã«åˆ‡æ›¿ï¼‰ã€‚

```
â”Œâ”€ Steps â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€ Detail â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              â”‚                                      â”‚
â”‚  ğŸ“‹ Plan: Auth System        â”‚ ## S2: JWTæ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯                â”‚
â”‚                              â”‚                                      â”‚
â”‚  â–¶ S1: èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ [*]  â”‚ pkg/auth/jwt.go ã«RS256ãƒ™ãƒ¼ã‚¹ã®       â”‚
â”‚    S1.1: JWTæ¤œè¨¼       [*]   â”‚ JWTæ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ã™ã‚‹ã€‚            â”‚
â”‚    S1.2: MWç™»éŒ²              â”‚                                      â”‚
â”‚  â–¶ S2: ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ›´æ–°      â”‚ å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«:                         â”‚
â”‚    S2.1: ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆè¿½åŠ   â”‚   pkg/auth/jwt.go                    â”‚
â”‚    S2.2: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³      â”‚   pkg/auth/jwt_test.go               â”‚
â”‚  â–¶ S3: ãƒ†ã‚¹ãƒˆè¿½åŠ             â”‚                                      â”‚
â”‚                              â”‚ ä¾å­˜: S1                             â”‚
â”‚                              â”‚                                      â”‚
â”‚                              â”‚ â”€â”€â”€ Review Comment â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                              â”‚ â”‚ HS256ã«å¤‰æ›´ã€‚éµã¯envã‹ã‚‰èª­ã‚€ã€‚    â”‚ â”‚
â”‚                              â”‚ â”‚                                  â”‚ â”‚
â”‚                              â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                              â”‚                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [j/k] navigate  [enter] toggle  [c] comment  [v] viewed  [q] quit â”‚
â”‚ [/] search  [s] submit review  [tab] switch pane  [?] help        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å·¦ãƒšã‚¤ãƒ³ï¼šã‚¹ãƒ†ãƒƒãƒ—ä¸€è¦§

- æœ€ä¸Šéƒ¨ã«ãƒ—ãƒ©ãƒ³ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆPlan.Titleï¼‰ã‚’è¡¨ç¤º
- ã‚¿ã‚¤ãƒˆãƒ«ç›´ä¸‹ã« "Overview" ã‚¨ãƒ³ãƒˆãƒªï¼ˆPlan.Preamble ã«å¯¾å¿œã€‚é¸æŠã™ã‚‹ã¨å³ãƒšã‚¤ãƒ³ã«preambleè¡¨ç¤ºï¼‰
- ãã®ä¸‹ã«ãƒ„ãƒªãƒ¼å½¢å¼ã§ã‚¹ãƒ†ãƒƒãƒ—ç¾¤ã‚’è¡¨ç¤ºï¼ˆè¦‹å‡ºã—ãƒ¬ãƒ™ãƒ«ã«åŸºã¥ãã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆï¼‰
- æŠ˜ã‚ŠãŸãŸã¿ / å±•é–‹ï¼ˆEnter or â† â†’ï¼‰
- å„ã‚¹ãƒ†ãƒƒãƒ—ã®ãƒãƒƒã‚¸ï¼š`[*]` ã‚³ãƒ¡ãƒ³ãƒˆã‚ã‚Šã€`[âœ“]` viewedæ¸ˆã¿
- ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ï¼ˆä¾‹: `S2 â† S1`ï¼‰ï¼ˆPhase 3ï¼‰
- ã‚«ãƒ¼ã‚½ãƒ«ç§»å‹•: `j`/`k` or â†‘/â†“
- å®Ÿè£…: bubbles/list ã® Delegate ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å‚è€ƒã«è‡ªä½œã€‚bubbles/list ãã®ã‚‚ã®ã¯
  ãƒ•ãƒ©ãƒƒãƒˆãƒªã‚¹ãƒˆå‘ã‘ã®ãŸã‚ã€ãƒ„ãƒªãƒ¼ã®æŠ˜ã‚ŠãŸãŸã¿/å±•é–‹ã‚’è¡¨ç¾ã™ã‚‹ã«ã¯ã‚«ã‚¹ã‚¿ãƒ å®Ÿè£…ãŒå¿…è¦ã€‚

#### å³ãƒšã‚¤ãƒ³ï¼šã‚¹ãƒ†ãƒƒãƒ—è©³ç´°

- é¸æŠä¸­ã‚¹ãƒ†ãƒƒãƒ—ã®æœ¬æ–‡ã‚’ Glamour ã§ANSIã‚¹ã‚¿ã‚¤ãƒ«ä»˜ããƒ†ã‚­ã‚¹ãƒˆã«å¤‰æ›ã—ã€bubbles/viewport ã§è¡¨ç¤º
- Glamour ã® dark ãƒ†ãƒ¼ãƒã‚’ãƒ™ãƒ¼ã‚¹ã«ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ã‚¤ãƒ«ã‚’é©ç”¨ï¼ˆChroma error ãƒˆãƒ¼ã‚¯ãƒ³ã®èµ¤èƒŒæ™¯ã‚’é™¤å»ã€‚
  CJK ãƒ†ã‚­ã‚¹ãƒˆãŒ error ãƒˆãƒ¼ã‚¯ãƒ³ã¨ã—ã¦èª¤èªè­˜ã•ã‚Œã‚‹ã¨èµ¤èƒŒæ™¯ã«ãªã‚‹ãŸã‚ï¼‰
- å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ï¼ˆãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤ºï¼‰ï¼ˆPhase 3ï¼‰
- ä¾å­˜é–¢ä¿‚ã®è¡¨ç¤ºï¼ˆPhase 3ï¼‰
- ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆå…¥åŠ›ã‚¨ãƒªã‚¢ï¼ˆä¸‹éƒ¨ã€bubbles/textarea ã‚’ãƒ©ãƒƒãƒ—ã—ãŸ comment ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆï¼‰

#### ã‚³ãƒ¡ãƒ³ãƒˆå…¥åŠ›ãƒ¢ãƒ¼ãƒ‰

- `c` ã‚­ãƒ¼ã§é–‹å§‹ã€textarea ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã§è¤‡æ•°è¡Œå…¥åŠ›
- `Esc` ã§ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã€`Ctrl+S` ã§ç¢ºå®š
- `Tab` ã§Conventional Commentsãƒ©ãƒ™ãƒ«ã‚’ã‚µã‚¤ã‚¯ãƒ«åˆ‡æ›¿
- ãƒ©ãƒ™ãƒ«: `suggestion` (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ), `issue`, `question`, `nitpick`, `todo`, `thought`, `note`, `praise`, `chore`

### å‡ºåŠ›

#### ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

```markdown
# Plan Review

Please review and address the following comments on: /path/to/plan.md

## S1.1: JWTæ¤œè¨¼ [suggestion]
HS256ã«å¤‰æ›´ã€‚éµã¯ç’°å¢ƒå¤‰æ•° `JWT_SECRET` ã‹ã‚‰èª­ã¿è¾¼ã‚€æ–¹å¼ã«ã—ã¦ã€‚

## S2: ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ›´æ–° [issue]
æ—¢å­˜ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å®Ÿè£…ã§å¯¾å¿œå¯èƒ½ãªãŸã‚ã€ã“ã®ã‚¹ãƒ†ãƒƒãƒ—ã¯ä¸è¦ã€‚

## S3: ãƒ†ã‚¹ãƒˆè¿½åŠ  [question]
ã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™ã¯80%ã¨90%ã®ã©ã¡ã‚‰ï¼Ÿ
```

> ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ: `## {StepID}: {StepTitle} [{ActionType}]`
> ã‚¹ãƒ†ãƒƒãƒ—ã‚¿ã‚¤ãƒˆãƒ«ã‚’å«ã‚ã‚‹ã“ã¨ã§ã€ClaudeãŒã©ã®ã‚¹ãƒ†ãƒƒãƒ—ã¸ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‹æ­£ç¢ºã«æŠŠæ¡ã§ãã‚‹ã€‚

#### å‡ºåŠ›å…ˆ

| æ–¹æ³• | èª¬æ˜ | ãƒ•ãƒ©ã‚° |
|------|------|--------|
| **ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰** (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ) | ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ | `--output clipboard` |
| **æ¨™æº–å‡ºåŠ›** | ãƒ‘ã‚¤ãƒ—é€£æºç”¨ | `--output stdout` |
| **ãƒ•ã‚¡ã‚¤ãƒ«** | æŒ‡å®šãƒ‘ã‚¹ã«æ›¸ãå‡ºã— | `--output file --output-path ./review.md` |
| **ãƒšã‚¤ãƒ³é€ä¿¡** (å°†æ¥) | åˆ¥ãƒšã‚¤ãƒ³ã«é€ä¿¡ | `--output pane` |

### ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰ä¸€è¦§

| ã‚­ãƒ¼ | ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ | ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ |
|------|-------------|-----------|
| `j` / `â†“` | ã‚¹ãƒ†ãƒƒãƒ—ä¸€è¦§ | æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã«ç§»å‹• |
| `k` / `â†‘` | ã‚¹ãƒ†ãƒƒãƒ—ä¸€è¦§ | å‰ã®ã‚¹ãƒ†ãƒƒãƒ—ã«ç§»å‹• |
| `Enter` | ã‚¹ãƒ†ãƒƒãƒ—ä¸€è¦§ | æŠ˜ã‚ŠãŸãŸã¿/å±•é–‹ã‚’ãƒˆã‚°ãƒ« |
| `â†’` / `l` | ã‚¹ãƒ†ãƒƒãƒ—ä¸€è¦§ | å±•é–‹ |
| `â†` / `h` | ã‚¹ãƒ†ãƒƒãƒ—ä¸€è¦§ | æŠ˜ã‚ŠãŸãŸã¿ |
| `Tab` | å…¨ä½“ | å·¦ãƒšã‚¤ãƒ³ â†” å³ãƒšã‚¤ãƒ³ã®ãƒ•ã‚©ãƒ¼ã‚«ã‚¹åˆ‡ã‚Šæ›¿ãˆ |
| `c` | ã‚¹ãƒ†ãƒƒãƒ—é¸æŠä¸­ | æ–°è¦ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ  |
| `C` | ã‚¹ãƒ†ãƒƒãƒ—é¸æŠä¸­ | ã‚³ãƒ¡ãƒ³ãƒˆä¸€è¦§ãƒ¢ãƒ¼ãƒ‰ã‚’é–‹å§‹ï¼ˆç·¨é›†ãƒ»å‰Šé™¤ï¼‰ |
| `v` | ã‚¹ãƒ†ãƒƒãƒ—é¸æŠä¸­ | viewedãƒãƒ¼ã‚¯ã‚’ãƒˆã‚°ãƒ« |
| `/` | ã‚¹ãƒ†ãƒƒãƒ—ä¸€è¦§ | æ¤œç´¢ãƒ¢ãƒ¼ãƒ‰ã‚’é–‹å§‹ |
| `Tab` | ã‚³ãƒ¡ãƒ³ãƒˆå…¥åŠ›ä¸­ | ãƒ©ãƒ™ãƒ«ã‚’ã‚µã‚¤ã‚¯ãƒ«åˆ‡æ›¿ |
| `Ctrl+S` | ã‚³ãƒ¡ãƒ³ãƒˆå…¥åŠ›ä¸­ | ã‚³ãƒ¡ãƒ³ãƒˆã‚’ç¢ºå®š |
| `Esc` | ã‚³ãƒ¡ãƒ³ãƒˆå…¥åŠ›ä¸­ / æ¤œç´¢ä¸­ | ã‚­ãƒ£ãƒ³ã‚»ãƒ« |
| `Enter` | æ¤œç´¢ä¸­ | æ¤œç´¢ã‚’ç¢ºå®š |
| `s` | å…¨ä½“ | ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’submitï¼ˆå‡ºåŠ›ã—ã¦çµ‚äº†ï¼‰ |
| `q` / `Ctrl+C` | å…¨ä½“ | çµ‚äº†ï¼ˆæœªä¿å­˜ã‚³ãƒ¡ãƒ³ãƒˆãŒã‚ã‚Œã°ç¢ºèªï¼‰ |
| `?` | å…¨ä½“ | ãƒ˜ãƒ«ãƒ—è¡¨ç¤º |

---

## Claude Codeçµ±åˆ â€” PostToolUseãƒ•ãƒƒã‚¯ã«ã‚ˆã‚‹ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹èµ·å‹•

### PostToolUse (Write|Edit) hookã‚’ä½¿ã†ç†ç”±

| hookã‚¤ãƒ™ãƒ³ãƒˆ | æ¤œè¨çµæœ |
|-------------|---------|
| Stop | planãƒ¢ãƒ¼ãƒ‰ã§ã¯ç™ºç«ã—ãªã„ãƒã‚°ãŒã‚ã‚‹ï¼ˆClaude Codeã®æ‰¿èªå¾…ã¡çŠ¶æ…‹ãŒStopã¨ã¿ãªã•ã‚Œãªã„ï¼‰ã€‚ |
| **PostToolUse (Write\|Edit)** âœ… | planãƒ¢ãƒ¼ãƒ‰ã§ã‚‚æ­£å¸¸ã«ç™ºç«ã€‚`tool_input.file_path` ã§ãƒ—ãƒ©ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç›´æ¥åˆ¤å®šå¯ã€‚exit 2ã§ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯æ³¨å…¥ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒTUIã§ã‚³ãƒ¡ãƒ³ãƒˆãªã—submit/cancelã‚’é¸ã¶ã“ã¨ã§ãƒ«ãƒ¼ãƒ—ã‚’åˆ¶å¾¡ã€‚Claudeã¯ãƒ—ãƒ©ãƒ³ä½œæˆæ™‚ã«Writeã€ä¿®æ­£æ™‚ã«Editã‚’ä½¿ç”¨ã€‚ |
| Notification | ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’Claudeã«æˆ»ã™ä»•çµ„ã¿ãŒãªã„ã€‚ |

### å‹•ä½œãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Claude Code (plan mode)                                         â”‚
â”‚                                                                 â”‚
â”‚  1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¨ˆç”»ã‚’ä¾é ¼                                         â”‚
â”‚  2. ClaudeãŒã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã‚’åˆ†æã—ã¦ãƒ—ãƒ©ãƒ³ã‚’ç”Ÿæˆ                    â”‚
â”‚  3. ClaudeãŒãƒ—ãƒ©ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ Write/Edit â†’ PostToolUse hookç™ºç«     â”‚
â”‚  4. ccplan hook ãŒ stdin ã‹ã‚‰ hookå…¥åŠ›ã‚’å—ã‘å–ã‚‹                  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ccplan hook (Go)                                         â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  5. permission_mode == "plan" ã‚’ç¢ºèª                      â”‚   â”‚
â”‚  â”‚  6. PLAN_REVIEW_SKIP ãƒã‚§ãƒƒã‚¯                              â”‚   â”‚
â”‚  â”‚  7. tool_input.file_path ãŒ plansDir é…ä¸‹ã‹åˆ¤å®š            â”‚   â”‚
â”‚  â”‚  8. internal/pane ã§éš£æ¥ãƒšã‚¤ãƒ³ã« ccplan review ã‚’èµ·å‹•       â”‚   â”‚
â”‚  â”‚  9. review ãƒ—ãƒ­ã‚»ã‚¹ã®å®Œäº†ã‚’å¾…æ©Ÿ                             â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚ ccplan review (åˆ¥ãƒšã‚¤ãƒ³)                         â”‚    â”‚   â”‚
â”‚  â”‚  â”‚                                                  â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ—ãƒ©ãƒ³ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼                        â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  å„ã‚¹ãƒ†ãƒƒãƒ—ã«ã‚³ãƒ¡ãƒ³ãƒˆä»˜ä¸                          â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  "s" ã§submit â†’ ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«å‡ºåŠ›       â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  TUIçµ‚äº† â†’ ãƒšã‚¤ãƒ³ãŒé–‰ã˜ã‚‹                         â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  10. çµæœåˆ¤å®š:                                            â”‚   â”‚
â”‚  â”‚      submitted â†’ stderr ã«ãƒ¬ãƒ“ãƒ¥ãƒ¼å†…å®¹ã€exit 2            â”‚   â”‚
â”‚  â”‚      approved  â†’ exit 0                                   â”‚   â”‚
â”‚  â”‚      cancelled â†’ exit 0                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  11-a. exit 2: Claude ãŒãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å—ã‘å–ã‚Šãƒ—ãƒ©ãƒ³ä¿®æ­£             â”‚
â”‚        â†’ å†åº¦Write/Edit â†’ PostToolUseç™ºç« â†’ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå†ãƒ¬ãƒ“ãƒ¥ãƒ¼å¯ â”‚
â”‚  11-b. exit 0: Claude ãŒç¶šè¡Œã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåˆ¤æ–­                     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ãƒãƒ«ãƒãƒ—ãƒ¬ã‚¯ã‚µæŠ½è±¡åŒ–

### ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹

```go
// PaneSpawner ã¯ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ãƒãƒ«ãƒãƒ—ãƒ¬ã‚¯ã‚µã®æŠ½è±¡åŒ–
type PaneSpawner interface {
    // SpawnAndWait ã¯æ–°ã—ã„ãƒšã‚¤ãƒ³ã§ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã€å®Œäº†ã‚’å¾…ã¤
    SpawnAndWait(cmd string, args []string) error
    // Available ã¯ã“ã®ã‚¹ãƒãƒ¼ãƒŠãƒ¼ãŒåˆ©ç”¨å¯èƒ½ã‹ã‚’è¿”ã™
    Available() bool
    // Name ã¯ãƒãƒ«ãƒãƒ—ãƒ¬ã‚¯ã‚µåã‚’è¿”ã™
    Name() string
}
```

### WezTermå®Ÿè£…

```go
func (w *WezTermSpawner) SpawnAndWait(cmd string, args []string) error {
    // 1. ãƒšã‚¤ãƒ³åˆ†å‰²ã—ã¦èµ·å‹•
    fullCmd := append([]string{cmd}, args...)
    splitArgs := append([]string{
        "cli", "split-pane", "--bottom", "--percent", "80", "--",
    }, fullCmd...)
    out, err := exec.Command("wezterm", splitArgs...).Output()
    if err != nil {
        return err
    }
    paneID := strings.TrimSpace(string(out))

    // 2. ãƒšã‚¤ãƒ³ã®çµ‚äº†ã‚’ãƒãƒ¼ãƒªãƒ³ã‚°ã§å¾…æ©Ÿ
    for {
        listOut, _ := exec.Command("wezterm", "cli", "list", "--format", "json").Output()
        if !paneExists(listOut, paneID) {
            break
        }
        time.Sleep(500 * time.Millisecond)
    }
    return nil
}
```

### è‡ªå‹•æ¤œå‡º

```go
func AutoDetect() PaneSpawner {
    spawners := []PaneSpawner{
        &WezTermSpawner{},
        &TmuxSpawner{},   // å°†æ¥
    }
    for _, s := range spawners {
        if s.Available() {
            return s
        }
    }
    return &DirectSpawner{} // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: ç¾åœ¨ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ç›´æ¥èµ·å‹•
}
```

---

## ãƒšã‚¤ãƒ³é€ä¿¡æ©Ÿèƒ½ï¼ˆå°†æ¥æ‹¡å¼µï¼‰

`ccplan review --output pane` ã§ã€ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœã‚’Claude CodeãŒå‹•ã„ã¦ã„ã‚‹åˆ¥ãƒšã‚¤ãƒ³ã«ç›´æ¥é€ä¿¡ã€‚

| ç’°å¢ƒ | é€ä¿¡æ–¹æ³• |
|------|---------|
| tmux | `tmux send-keys -t {target-pane} "ãƒ†ã‚­ã‚¹ãƒˆ" Enter` |
| WezTerm | `wezterm cli send-text --pane-id {id} "ãƒ†ã‚­ã‚¹ãƒˆ"` |

- `--pane-target` ã§æ˜ç¤ºæŒ‡å®šã€æœªæŒ‡å®šãªã‚‰ç’°å¢ƒå¤‰æ•°ã‹ã‚‰è‡ªå‹•æ¤œå‡º
- é•·æ–‡æ™‚ã¯tmpãƒ•ã‚¡ã‚¤ãƒ«çµŒç”± + `@` å‚ç…§ã‚³ãƒãƒ³ãƒ‰ã¨ã—ã¦é€ä¿¡

---

## ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

### internal/plan/model.go

```go
// Plan ã¯ãƒ‘ãƒ¼ã‚¹æ¸ˆã¿ãƒ—ãƒ©ãƒ³ã®å…¨ä½“æ§‹é€ 
type Plan struct {
    Title    string  // H1è¦‹å‡ºã—ï¼ˆãªã‘ã‚Œã°ãƒ•ã‚¡ã‚¤ãƒ«åï¼‰
    Preamble string  // æœ€åˆã®è¦‹å‡ºã—å‰ã®ãƒ†ã‚­ã‚¹ãƒˆï¼ˆæ¦‚è¦ï¼‰
    Steps    []*Step // ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã®ã‚¹ãƒ†ãƒƒãƒ—ç¾¤
}

// Step ã¯ãƒ—ãƒ©ãƒ³å†…ã®1ã‚¹ãƒ†ãƒƒãƒ—ï¼ˆè¦‹å‡ºã—1ã¤ã«å¯¾å¿œï¼‰
type Step struct {
    ID       string  // è‡ªå‹•æ¡ç•ª "S1", "S1.1", "S2" ç­‰
    Title    string  // è¦‹å‡ºã—ãƒ†ã‚­ã‚¹ãƒˆï¼ˆ"## " éƒ¨åˆ†ã¯é™¤å»æ¸ˆã¿ï¼‰
    Level    int     // è¦‹å‡ºã—ãƒ¬ãƒ™ãƒ«ï¼ˆ2=##, 3=###, ...ï¼‰
    Body     string  // è¦‹å‡ºã—ã‹ã‚‰æ¬¡ã®è¦‹å‡ºã—ã¾ã§ã®MarkdownåŸæ–‡
    Children []*Step // ä¸‹ä½ãƒ¬ãƒ™ãƒ«ã®å­ã‚¹ãƒ†ãƒƒãƒ—
    Parent   *Step   // è¦ªã‚¹ãƒ†ãƒƒãƒ—ï¼ˆnil ãªã‚‰ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ï¼‰

    // ãƒ‘ãƒ¼ã‚¹æ™‚ã«ãƒ™ã‚¹ãƒˆã‚¨ãƒ•ã‚©ãƒ¼ãƒˆã§æŠ½å‡ºï¼ˆPhase 3ï¼‰
    FilePaths    []string // æœ¬æ–‡ä¸­ã«å‡ºç¾ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹
    Dependencies []string // ä»–ã‚¹ãƒ†ãƒƒãƒ—ã¸ã®å‚ç…§ï¼ˆ"S1" ç­‰ï¼‰
}

// StepID ã¯è¦‹å‡ºã—ã®å‡ºç¾é †ã¨ãƒ¬ãƒ™ãƒ«ã‹ã‚‰æ±ºå®šã™ã‚‹ã€‚
// H1 ã¯ Plan.Title ã«ä½¿ã†ãŸã‚ã€ã‚¹ãƒ†ãƒƒãƒ—ã®IDã¯H2ä»¥é™ãŒå¯¾è±¡ã€‚
//
//   ## Foo      â†’ S1
//   ### Bar     â†’ S1.1
//   ### Baz     â†’ S1.2
//   ## Qux      â†’ S2
//   ### Quux    â†’ S2.1
//   #### Deep   â†’ S2.1.1
```

### internal/plan/review.go

```go
// ReviewComment ã¯1ã‚¹ãƒ†ãƒƒãƒ—ã¸ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆ
type ReviewComment struct {
    StepID string     // å¯¾è±¡ã‚¹ãƒ†ãƒƒãƒ—ã®ID
    Action ActionType // ã‚³ãƒ¡ãƒ³ãƒˆã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç¨®åˆ¥
    Body   string     // ã‚³ãƒ¡ãƒ³ãƒˆæœ¬æ–‡
}

// ActionType ã¯ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç¨®åˆ¥
type ActionType string

const (
    ActionSuggestion ActionType = "suggestion" // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
    ActionIssue      ActionType = "issue"
    ActionQuestion   ActionType = "question"
    ActionNitpick    ActionType = "nitpick"
    ActionTodo       ActionType = "todo"
    ActionThought    ActionType = "thought"
    ActionNote       ActionType = "note"
    ActionPraise     ActionType = "praise"
    ActionChore      ActionType = "chore"
)

// ReviewResult ã¯ãƒ¬ãƒ“ãƒ¥ãƒ¼å…¨ä½“ã®çµæœ
type ReviewResult struct {
    Comments []ReviewComment
    Status   Status
}

// Status ã¯TUIçµ‚äº†æ™‚ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
type Status string

const (
    StatusSubmitted Status = "submitted" // ã‚³ãƒ¡ãƒ³ãƒˆã‚ã‚Š
    StatusApproved  Status = "approved"  // ã‚³ãƒ¡ãƒ³ãƒˆãªã—
    StatusCancelled Status = "cancelled" // q ã§ä¸­æ–­
)
```

### ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¤å®šãƒ«ãƒ¼ãƒ«

| ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œ | Status | ç†ç”± |
|-------------|--------|------|
| `s` ã‚’æŠ¼ã—ã¦submitã€ã‚³ãƒ¡ãƒ³ãƒˆãŒ1ã¤ä»¥ä¸Šã‚ã‚‹ | `submitted` | ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãŒã‚ã‚‹ |
| `s` ã‚’æŠ¼ã—ã¦submitã€ã‚³ãƒ¡ãƒ³ãƒˆãŒ0ä»¶ | `approved` | ä¿®æ­£ä¸è¦ã®æ„æ€è¡¨ç¤º |
| `q` / `Ctrl+C` ã§ä¸­æ–­ | `cancelled` | ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¸­æ–­ |

---

## TUIçŠ¶æ…‹é·ç§»

### ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¢ãƒ¼ãƒ‰

```go
type AppMode int

const (
    ModeNormal      AppMode = iota // ã‚¹ãƒ†ãƒƒãƒ—ä¸€è¦§ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
    ModeComment                    // ã‚³ãƒ¡ãƒ³ãƒˆå…¥åŠ›ä¸­ï¼ˆtextareaã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ï¼‰
    ModeCommentList                // ã‚³ãƒ¡ãƒ³ãƒˆä¸€è¦§ï¼ˆç·¨é›†ãƒ»å‰Šé™¤ï¼‰
    ModeConfirm                    // ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ï¼ˆæœªä¿å­˜ã‚³ãƒ¡ãƒ³ãƒˆãŒã‚ã‚‹çŠ¶æ…‹ã§ q ã‚’æŠ¼ã—ãŸç­‰ï¼‰
    ModeHelp                       // ãƒ˜ãƒ«ãƒ—ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤è¡¨ç¤ºä¸­
    ModeSearch                     // ã‚¹ãƒ†ãƒƒãƒ—æ¤œç´¢ï¼ˆã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ã‚¿ãƒ«ãƒ•ã‚£ãƒ«ã‚¿ï¼‰
)
```

### çŠ¶æ…‹é·ç§»å›³

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  ModeNormal  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
                           â”‚                               â”‚
             c ã‚­ãƒ¼        â”‚         ? ã‚­ãƒ¼                â”‚ Esc / Enter
                           â–¼                               â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ ModeComment  â”‚                â”‚   ModeHelp   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
           Ctrl+S (ç¢ºå®š)   â”‚    Esc (ã‚­ãƒ£ãƒ³ã‚»ãƒ«)
           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º ModeNormal
                           â”‚
                           â–¼
                    ã‚³ãƒ¡ãƒ³ãƒˆä¿å­˜
                    â†’ ModeNormal

     q ã‚­ãƒ¼ (ModeNormal)
           â”‚
           â”œâ”€â”€ æœªä¿å­˜ã‚³ãƒ¡ãƒ³ãƒˆãªã— â†’ å³åº§ã«çµ‚äº†
           â”‚
           â””â”€â”€ æœªä¿å­˜ã‚³ãƒ¡ãƒ³ãƒˆã‚ã‚Š
                    â”‚
                    â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ ModeConfirm  â”‚
              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
         y (çµ‚äº†)    â”‚    n (ã‚­ãƒ£ãƒ³ã‚»ãƒ«)
         â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º ModeNormal
                     â”‚
                     â–¼
                ã‚¢ãƒ—ãƒªçµ‚äº†ï¼ˆStatusCancelledï¼‰
```

### ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ç®¡ç†

```
ModeNormal:
  ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ = å·¦ãƒšã‚¤ãƒ³ï¼ˆã‚¹ãƒ†ãƒƒãƒ—ä¸€è¦§ï¼‰
  Tab ã§å³ãƒšã‚¤ãƒ³ï¼ˆviewportï¼‰ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ç§»å‹•å¯
  å³ãƒšã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚: j/k ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã€Tab ã§å·¦ã«æˆ»ã‚‹

ModeComment:
  ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ = å³ãƒšã‚¤ãƒ³ä¸‹éƒ¨ã® textarea
  å·¦ãƒšã‚¤ãƒ³ã®ã‚­ãƒ¼æ“ä½œã¯ç„¡åŠ¹
  Esc ã§ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã€Ctrl+S ã§ç¢ºå®š â†’ ModeNormal ã«æˆ»ã‚‹
```

---

## ãƒ‘ãƒ¼ã‚µãƒ¼ã®ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹å‡¦ç†

| ã‚±ãƒ¼ã‚¹ | å‡¦ç† |
|-------|------|
| è¦‹å‡ºã—ãŒ1ã¤ã‚‚ãªã„ | Planå…¨ä½“ã‚’1ã¤ã® preamble ã¨ã—ã¦æ‰±ã†ã€‚ã‚¹ãƒ†ãƒƒãƒ—ä¸€è¦§ã¯ç©ºã€å³ãƒšã‚¤ãƒ³ã«preambleè¡¨ç¤º |
| H1ã®ã¿ï¼ˆH2ä»¥é™ãªã—ï¼‰ | Title = H1ãƒ†ã‚­ã‚¹ãƒˆã€æœ¬æ–‡å…¨ä½“ãŒpreamble |
| H1ãŒè¤‡æ•°ã‚ã‚‹ | æœ€åˆã®H1ã‚’Titleã€2ã¤ç›®ä»¥é™ã®H1ã‚‚ã‚¹ãƒ†ãƒƒãƒ—ã¨ã—ã¦æ‰±ã†ï¼ˆLevel 1 â†’ S1, S2, ...ï¼‰ |
| H3ãŒH2ãªã—ã§å‡ºç¾ï¼ˆãƒ¬ãƒ™ãƒ«é£›ã³ï¼‰ | ãã®ã¾ã¾ã®ãƒ¬ãƒ™ãƒ«ã§ã‚¹ãƒ†ãƒƒãƒ—ã¨ã—ã¦ç™»éŒ²ã€‚è¦ªã¯ãªã—ï¼ˆãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«æ‰±ã„ï¼‰ |
| ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯å†…ã® `#` | goldmark ASTã§ã¯ CodeBlock/FencedCodeBlock ãƒãƒ¼ãƒ‰ã«ãªã‚‹ãŸã‚è¦‹å‡ºã—ã¨èª¤èªã—ãªã„ |
| ç©ºã®è¦‹å‡ºã— `## ` | Title = ""ï¼ˆç©ºæ–‡å­—åˆ—ï¼‰ã€ID ã¯é€šå¸¸é€šã‚Šæ¡ç•ª |
| éå¸¸ã«é•·ã„æœ¬æ–‡ï¼ˆ1000è¡Œè¶…ï¼‰ | ãƒ‘ãƒ¼ã‚¹è‡ªä½“ã¯è¡Œã†ã€‚viewportã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã§å¯¾å¿œã€‚ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å•é¡Œã¯Phase 3ã§å¯¾å¿œ |

---

## ã‚³ãƒ¡ãƒ³ãƒˆæ“ä½œã®è©³ç´°

### ã‚³ãƒ¡ãƒ³ãƒˆã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«

1ã‚¹ãƒ†ãƒƒãƒ—ã«è¤‡æ•°ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’ä»˜ä¸å¯èƒ½ã€‚

| æ“ä½œ | æ–¹æ³• |
|------|------|
| æ–°è¦è¿½åŠ  | `c` ã‚­ãƒ¼ã§ç©ºã®textareaã‚’é–‹ã„ã¦å…¥åŠ›ã€`Tab` ã§ãƒ©ãƒ™ãƒ«åˆ‡æ›¿ã€`Ctrl+S` ã§ç¢ºå®šã€‚å¸¸ã«æ–°è¦ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ  |
| ä¸€è¦§è¡¨ç¤º | `C` ã‚­ãƒ¼ã§ã‚³ãƒ¡ãƒ³ãƒˆä¸€è¦§ãƒ¢ãƒ¼ãƒ‰ã‚’é–‹å§‹ã€‚`j/k` ã§ã‚³ãƒ¡ãƒ³ãƒˆé–“ç§»å‹• |
| ç·¨é›† | ã‚³ãƒ¡ãƒ³ãƒˆä¸€è¦§ãƒ¢ãƒ¼ãƒ‰ã§ `e` â†’ æ—¢å­˜ã‚³ãƒ¡ãƒ³ãƒˆãŒãƒ—ãƒªãƒ•ã‚£ãƒ«ã•ã‚ŒãŸçŠ¶æ…‹ã§ç·¨é›† â†’ ä¿å­˜å¾Œä¸€è¦§ã«æˆ»ã‚‹ |
| å‰Šé™¤ | ã‚³ãƒ¡ãƒ³ãƒˆä¸€è¦§ãƒ¢ãƒ¼ãƒ‰ã§ `d` â†’ é¸æŠä¸­ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’å‰Šé™¤ã€‚æœ€å¾Œã®1ä»¶ã‚’å‰Šé™¤ã™ã‚‹ã¨ãƒãƒ¼ãƒãƒ«ãƒ¢ãƒ¼ãƒ‰ã«æˆ»ã‚‹ |
| viewed ãƒãƒ¼ã‚¯ | `v` ã‚­ãƒ¼ â†’ ã‚¹ãƒ†ãƒƒãƒ—ã‚’ç¢ºèªæ¸ˆã¿ã¨ã—ã¦ãƒãƒ¼ã‚¯ï¼ˆãƒ¬ãƒ“ãƒ¥ãƒ¼å‡ºåŠ›ã«ã¯å«ã¾ã‚Œãªã„ï¼‰ |

### Conventional Comments ãƒ©ãƒ™ãƒ«

ã‚³ãƒ¡ãƒ³ãƒˆå…¥åŠ›æ™‚ã« `Tab` ã‚­ãƒ¼ã§ä»¥ä¸‹ã®ãƒ©ãƒ™ãƒ«ã‚’ã‚µã‚¤ã‚¯ãƒ«åˆ‡æ›¿:

| ãƒ©ãƒ™ãƒ« | ç”¨é€” |
|--------|------|
| `suggestion` (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ) | æ”¹å–„ææ¡ˆ |
| `issue` | å…·ä½“çš„ãªå•é¡Œã®æŒ‡æ‘˜ |
| `question` | è³ªå•ãƒ»ç¢ºèª |
| `nitpick` | äº›ç´°ãªå¥½ã¿ã®å•é¡Œ |
| `todo` | å¿…è¦ãªå°ã•ãªå¤‰æ›´ |
| `thought` | ã‚¢ã‚¤ãƒ‡ã‚¢ãƒ»å‚è€ƒæƒ…å ± |
| `note` | æƒ…å ±ã®å¼·èª¿ |
| `praise` | ãƒã‚¸ãƒ†ã‚£ãƒ–ãªç‚¹ |
| `chore` | å—ã‘å…¥ã‚Œå‰ã«å¿…è¦ãªä½œæ¥­ |

---

## ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰

- ãƒ©ã‚¤ãƒ–ãƒ©ãƒª: [atotto/clipboard](https://github.com/atotto/clipboard)
- macOS: `pbcopy` / Linux: `xclip` or `xsel` / WSL: `clip.exe`
- atotto/clipboard ãŒã“ã‚Œã‚‰ã‚’å†…éƒ¨ã§è‡ªå‹•åˆ¤åˆ¥ã™ã‚‹ãŸã‚ã€æ˜ç¤ºçš„ãªåˆ†å²ã¯ä¸è¦
- ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ä½¿ç”¨ä¸å¯ã®ç’°å¢ƒï¼ˆSSHå…ˆã®ã‚µãƒ¼ãƒç­‰ï¼‰ã§ã¯ã€ã‚³ãƒ”ãƒ¼å¤±æ•—æ™‚ã«ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã—ã€
  `--output stdout` ã¾ãŸã¯ `--output file` ã®ä½¿ç”¨ã‚’ææ¡ˆã™ã‚‹

---

## ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æ–¹é‡

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | ã‚¨ãƒ©ãƒ¼ç¨®åˆ¥ | å¯¾å¿œ |
|--------------|-----------|------|
| `ccplan review` | ãƒ—ãƒ©ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ãªã„ | ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡ºåŠ›ã—ã¦ exit 1 |
| `ccplan review` | ãƒ—ãƒ©ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ãƒ¼ã‚¹å¤±æ•— | å¯èƒ½ãªç¯„å›²ã§ãƒ‘ãƒ¼ã‚¹ã€‚å®Œå…¨ã«å£Šã‚Œã¦ã„ã‚‹å ´åˆã¯ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ + exit 1 |
| `ccplan review` | ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚µã‚¤ã‚ºå–å¾—å¤±æ•— | 80x24 ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¨ã—ã¦ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ |
| `ccplan review` | ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã‚³ãƒ”ãƒ¼å¤±æ•— | stderrã«ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã€exit code ã¯ 0ï¼ˆãƒ¬ãƒ“ãƒ¥ãƒ¼è‡ªä½“ã¯å®Œäº†ï¼‰ |
| `ccplan locate` | transcriptãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ãªã„ | ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ + exit 1 |
| `ccplan locate` | JSONL ãƒ‘ãƒ¼ã‚¹å¤±æ•—ï¼ˆä¸€éƒ¨è¡Œï¼‰ | ãã®è¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¦ç¶šè¡Œ |
| `ccplan locate` | ãƒ—ãƒ©ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚‰ãªã„ | ç©ºå‡ºåŠ› + exit 1 |
| `ccplan locate` | settings.json ãŒå£Šã‚Œã¦ã„ã‚‹ | ãã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¹ã‚­ãƒƒãƒ—ã€æ¬¡ã®å„ªå…ˆåº¦ã¸ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ |
| `ccplan hook` | hookå…¥åŠ›JSONã®ãƒ‘ãƒ¼ã‚¹å¤±æ•— | exit 0ï¼ˆä½•ã‚‚ã—ãªã„ï¼‰ã€‚stderrã«ãƒ­ã‚°å‡ºåŠ› |
| `ccplan hook` | ãƒšã‚¤ãƒ³ã‚¹ãƒãƒ¼ãƒ³å¤±æ•— | DirectSpawnerã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã€‚ãã‚Œã‚‚å¤±æ•—ãªã‚‰ exit 0 |
| `ccplan hook` | reviewãƒ—ãƒ­ã‚»ã‚¹ãŒç•°å¸¸çµ‚äº† | exit 0ï¼ˆä½•ã‚‚ã—ãªã„ï¼‰ |

**åŸå‰‡**: `ccplan hook` ã¯æ±ºã—ã¦Claude Codeã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å£Šã•ãªã„ã€‚
ã‚ã‚‰ã‚†ã‚‹æƒ³å®šå¤–ã®ã‚¨ãƒ©ãƒ¼ã§ exit 0ï¼ˆä½•ã‚‚ã—ãªã„ï¼‰ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã™ã‚‹ã€‚

---

## ãƒ†ã‚¹ãƒˆæ–¹é‡

### ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ

| ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ | ãƒ†ã‚¹ãƒˆå¯¾è±¡ | ãƒ†ã‚¹ãƒˆæ–¹æ³• |
|-----------|-----------|-----------|
| `internal/plan` | Markdownãƒ‘ãƒ¼ã‚µãƒ¼ | ãƒ†ã‚¹ãƒˆç”¨.mdãƒ•ã‚¡ã‚¤ãƒ«ã‚’ `testdata/` ã«é…ç½®ã€‚å„ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã®goldenãƒ•ã‚¡ã‚¤ãƒ«ãƒ†ã‚¹ãƒˆ |
| `internal/plan` | ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ | ReviewResult â†’ Markdownæ–‡å­—åˆ—ã®å¤‰æ›ã‚’æ¤œè¨¼ |
| `internal/locate` | transcript JSONLãƒ‘ãƒ¼ã‚µãƒ¼ | ãƒ†ã‚¹ãƒˆç”¨.jsonlãƒ•ã‚¡ã‚¤ãƒ«ã‚’ `testdata/` ã«é…ç½® |
| `internal/locate` | plansDirectoryè§£æ±º | ä¸€æ™‚ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«settings.jsonã‚’é…ç½®ã—ã¦ãƒ†ã‚¹ãƒˆ |
| `internal/hook` | hookå…¥åŠ›ãƒ‘ãƒ¼ã‚µãƒ¼ï¼ˆPhase 2ï¼‰ | å„ç¨®JSONå…¥åŠ›ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆæ­£å¸¸ã€planä»¥å¤–ã€tool_input nullç­‰ï¼‰ |

### ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®ç®¡ç†

```
ccplan/
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ plan/
â”‚   â”‚   â””â”€â”€ testdata/
â”‚   â”‚       â”œâ”€â”€ basic.md              # åŸºæœ¬çš„ãªãƒ—ãƒ©ãƒ³
â”‚   â”‚       â”œâ”€â”€ no-headings.md        # è¦‹å‡ºã—ãªã—
â”‚   â”‚       â”œâ”€â”€ deep-nesting.md       # H4ä»¥é™ã®æ·±ã„ãƒã‚¹ãƒˆ
â”‚   â”‚       â”œâ”€â”€ code-block-hash.md    # ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯å†…ã« # ãŒã‚ã‚‹
â”‚   â”‚       â””â”€â”€ single-step.md        # ã‚¹ãƒ†ãƒƒãƒ—ãŒ1ã¤ã ã‘
â”‚   â””â”€â”€ locate/
â”‚       â””â”€â”€ testdata/
â”‚           â”œâ”€â”€ transcript-with-plan.jsonl
â”‚           â”œâ”€â”€ transcript-no-plan.jsonl
â”‚           â”œâ”€â”€ transcript-multiple-plans.jsonl
â”‚           â””â”€â”€ transcript-malformed.jsonl
```

### TUIãƒ†ã‚¹ãƒˆ

`internal/tui/app_test.go` ã«å›å¸°ãƒ†ã‚¹ãƒˆã‚’å®Ÿè£…æ¸ˆã¿:

- **ç”»é¢ã¯ã¿å‡ºã—é˜²æ­¢**: å„ãƒ¢ãƒ¼ãƒ‰ï¼ˆNormal, Comment, Confirm, Helpï¼‰Ã— è¤‡æ•°ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚µã‚¤ã‚ºã§
  `View()` ã®å‡ºåŠ›è¡Œæ•°ãŒã‚¿ãƒ¼ãƒŸãƒŠãƒ«é«˜ã•ã‚’è¶…ãˆãªã„ã“ã¨ã‚’æ¤œè¨¼
- **ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«è¿½å¾“**: ã‚«ãƒ¼ã‚½ãƒ«ã‚’å¯è¦–ç¯„å›²å¤–ã¾ã§ç§»å‹•ã—ãŸéš›ã«ã€é¸æŠä¸­ã®ã‚¹ãƒ†ãƒƒãƒ—ãŒ
  ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°çµæœã«å«ã¾ã‚Œã‚‹ã“ã¨ã‚’æ¤œè¨¼

> **å®Ÿè£…ãƒ¡ãƒ¢**: `tea.Program` ã‚’ä»‹ã•ãšã€`NewApp()` â†’ `Update(WindowSizeMsg)` â†’ `View()` ã§
> ç›´æ¥ãƒ¢ãƒ‡ãƒ«ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹æ–¹å¼ã€‚E2Eçš„ãªæ“ä½œãƒ†ã‚¹ãƒˆã¯å°†æ¥ teatest ã§å¯¾å¿œäºˆå®šã€‚

---

## ãƒ“ãƒ«ãƒ‰ãƒ»é…å¸ƒ

### Go ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒ»ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«

```
Go: 1.26
Module: github.com/koh-sh/ccplan
```

### ãƒ“ãƒ«ãƒ‰

```bash
# é–‹ç™ºç”¨
go build -o ccplan .

# ãƒãƒ¼ã‚¸ãƒ§ãƒ³åŸ‹ã‚è¾¼ã¿
go build -ldflags "-X main.version=$(git describe --tags)" -o ccplan .
```

### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# go install
go install github.com/koh-sh/ccplan@latest

# ãƒã‚¤ãƒŠãƒªã‚’ PATH ã®é€šã£ãŸå ´æ‰€ã«é…ç½®
# hookã‹ã‚‰å‘¼ã°ã‚Œã‚‹ãŸã‚ã€ccplan ãŒ PATH ä¸Šã«ã‚ã‚‹å¿…è¦ãŒã‚ã‚‹
```

### CIï¼ˆGitHub Actionsæƒ³å®šï¼‰

- `go vet` / `staticcheck`
- `go test ./...`
- goreleaser ã§ã‚¯ãƒ­ã‚¹ã‚³ãƒ³ãƒ‘ã‚¤ãƒ« + ãƒªãƒªãƒ¼ã‚¹ï¼ˆdarwin/arm64, darwin/amd64, linux/amd64ï¼‰

---

## éæ©Ÿèƒ½è¦ä»¶

- **èµ·å‹•é€Ÿåº¦**: 100msä»¥å†…ï¼ˆãƒ—ãƒ©ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ãƒ¼ã‚¹ã‚’å«ã‚€ï¼‰
- **å¯¾å¿œãƒ—ãƒ©ãƒ³ã‚µã‚¤ã‚º**: 1000è¡Œç¨‹åº¦ã®Markdownã¾ã§å¿«é©ã«å‹•ä½œ
- **ã‚¿ãƒ¼ãƒŸãƒŠãƒ«äº’æ›æ€§**: 256è‰² + True Colorå¯¾å¿œã€‚æœ€ä½é™16è‰²ã§ã‚‚ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå´©ã‚Œãªã—
- **æœ€å°ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚µã‚¤ã‚º**: 80x24ï¼ˆã“ã‚Œä»¥ä¸‹ã§ã¯ã‚·ãƒ³ã‚°ãƒ«ãƒšã‚¤ãƒ³ã«è‡ªå‹•åˆ‡æ›¿ï¼‰
- **ä¾å­˜é–¢ä¿‚**: å¤–éƒ¨ãƒã‚¤ãƒŠãƒªã¸ã®ä¾å­˜ãªã—ï¼ˆGoå˜ä½“ã§ãƒ“ãƒ«ãƒ‰ï¼‰ã€‚
  hookãƒ¢ãƒ¼ãƒ‰ã®ãƒšã‚¤ãƒ³èµ·å‹•æ™‚ã®ã¿ `wezterm` or `tmux` CLIãŒå¿…è¦ï¼ˆãªã‘ã‚Œã°ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰ã€‚
- **transcript JSONLäº’æ›æ€§**: ãƒ‘ãƒ¼ã‚¹å¤±æ•—æ™‚ã¯å¸¸ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œï¼ˆexit 0 / ç©ºå‡ºåŠ›ï¼‰ã€‚
  Claude Codeãƒãƒ¼ã‚¸ãƒ§ãƒ³å¤‰æ›´æ™‚ã®ç ´æã‚’æœ€å°åŒ–ã€‚

---

## é–‹ç™ºãƒ•ã‚§ãƒ¼ã‚º

### Phase 1: MVP

- **`ccplan review`**: TUIãƒ“ãƒ¥ãƒ¼ã‚¢ + ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½
  - Markdownãƒ‘ãƒ¼ã‚µãƒ¼ï¼ˆgoldmark ASTã‹ã‚‰è¦‹å‡ºã—ãƒ™ãƒ¼ã‚¹ã®ã‚¹ãƒ†ãƒƒãƒ—åˆ†å‰²ï¼‰
  - 2ãƒšã‚¤ãƒ³TUIï¼ˆã‚¹ãƒ†ãƒƒãƒ—ä¸€è¦§ãƒ„ãƒªãƒ¼ + Glamour/viewport ã«ã‚ˆã‚‹è©³ç´°è¡¨ç¤ºï¼‰
  - æŠ˜ã‚ŠãŸãŸã¿/å±•é–‹
  - ã‚³ãƒ¡ãƒ³ãƒˆå…¥åŠ›ï¼ˆbubbles/textareaï¼‰
  - å‡ºåŠ›ï¼ˆclipboard / stdout / fileï¼‰
- **`ccplan locate`**: transcriptè§£æ + plansDirectoryè§£æ±º
  - JSONL transcriptãƒ‘ãƒ¼ã‚µãƒ¼
  - settings.json ã® plansDirectory è§£æ±ºãƒã‚§ãƒ¼ãƒ³
  - `--stdin` / `--transcript` / `--all` ãƒ•ãƒ©ã‚°

### Phase 2: Claude Codeçµ±åˆ

- **`ccplan hook`**: PostToolUse (Write|Edit) hookã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  - hookå…¥åŠ›ãƒ‘ãƒ¼ã‚µãƒ¼ï¼ˆpermission_mode / tool_input.file_pathï¼‰
  - plansDiråˆ¤å®š â†’ review â†’ exit code ã®åˆæˆãƒ•ãƒ­ãƒ¼
- WezTerm PaneSpawnerå®Ÿè£…ï¼ˆ`--spawn-pane`ï¼‰
- E2Eãƒ•ãƒ­ãƒ¼ã®æ¤œè¨¼

### Phase 3: å¯è¦–åŒ–å¼·åŒ–

- ä¾å­˜é–¢ä¿‚ã®ãƒ„ãƒªãƒ¼è¡¨ç¤ºãƒ»çŸ¢å°
- ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã®è‡ªå‹•æŠ½å‡ºã¨ãƒã‚¤ãƒ©ã‚¤ãƒˆï¼ˆgoldmark ASTã‹ã‚‰ã‚³ãƒ¼ãƒ‰ã‚¹ãƒ‘ãƒ³ãƒ»ãƒªãƒ³ã‚¯ã‚’èµ°æŸ»ï¼‰
- Glamourã®ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆãƒ†ãƒ¼ãƒå¯¾å¿œã€ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ«ç­‰ï¼‰

### Phase 4: ãƒãƒ«ãƒãƒ—ãƒ¬ã‚¯ã‚µå¯¾å¿œæ‹¡å¼µ + å°†æ¥ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰

- tmux PaneSpawnerå®Ÿè£…
- `ccplan review --output pane`
- `ccplan list`: plansDirectoryå†…ã®ãƒ—ãƒ©ãƒ³ä¸€è¦§
- `ccplan diff`: ãƒ—ãƒ©ãƒ³é–“ã®å·®åˆ†è¡¨ç¤º
- `ccplan clean`: å¤ã„ãƒ—ãƒ©ãƒ³ã®æƒé™¤
